<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>APM:Libraries: libraries/AP_Camera/AP_Camera.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_b76129510ac982b4d1d339675e39410f.html">AP_Camera</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_Camera.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__Camera_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__Camera_8h.html">AP_Camera.h</a>&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Relay_8h.html">AP_Relay/AP_Relay.h</a>&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Math_8h.html">AP_Math/AP_Math.h</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="RC__Channel_8h.html">RC_Channel/RC_Channel.h</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_PX4</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;drivers/drv_input_capture.h&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;drivers/drv_pwm_output.h&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="fcntl_8h.html">fcntl.h</a>&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// ------------------------------</span></div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="AP__Camera_8cpp.html#a89803387a4a662cb3a519d38dee85bc4">   16</a></span>&#160;<span class="preprocessor">#define CAM_DEBUG DISABLED</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__Camera.html#a0819e25b3f6e6c173f25842dbfd8d50c">AP_Camera::var_info</a>[] = {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment">// @Param: TRIGG_TYPE</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">// @DisplayName: Camera shutter (trigger) type</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// @Description: how to trigger the camera to take a picture</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment">// @Values: 0:Servo,1:Relay</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TRIGG_TYPE&quot;</span>,  0, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _trigger_type, <a class="code" href="AP__Camera_8h.html#a1ccb29b0c458e967baa34127677cd15b">AP_CAMERA_TRIGGER_DEFAULT_TRIGGER_TYPE</a>),</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment">// @Param: DURATION</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// @DisplayName: Duration that shutter is held open</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// @Description: How long the shutter will be held open in 10ths of a second (i.e. enter 10 for 1second, 50 for 5seconds)</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// @Units: deciseconds</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// @Range: 0 50</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DURATION&quot;</span>,    1, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _trigger_duration, <a class="code" href="AP__Camera_8h.html#a77e9f793badf723626ba9cc8447f3e58">AP_CAMERA_TRIGGER_DEFAULT_DURATION</a>),</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// @Param: SERVO_ON</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// @DisplayName: Servo ON PWM value</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// @Description: PWM value to move servo to when shutter is activated</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// @Units: pwm</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// @Range: 1000 2000</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SERVO_ON&quot;</span>,    2, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _servo_on_pwm, <a class="code" href="AP__Camera_8h.html#adb9fdb00ca2e2319ea1dc5dd6ab92f91">AP_CAMERA_SERVO_ON_PWM</a>),</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// @Param: SERVO_OFF</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// @DisplayName: Servo OFF PWM value</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// @Description: PWM value to move servo to when shutter is deactivated</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// @Units: pwm</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// @Range: 1000 2000</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SERVO_OFF&quot;</span>,   3, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _servo_off_pwm, <a class="code" href="AP__Camera_8h.html#a02e6f5dab509e2d0ab6fb1157a4a305f">AP_CAMERA_SERVO_OFF_PWM</a>),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// @Param: TRIGG_DIST</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// @DisplayName: Camera trigger distance</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// @Description: Distance in meters between camera triggers. If this value is non-zero then the camera will trigger whenever the GPS position changes by this number of meters regardless of what mode the APM is in. Note that this parameter can also be set in an auto mission using the DO_SET_CAM_TRIGG_DIST command, allowing you to enable/disable the triggering of the camera during the flight.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// @Units: meters</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// @Range: 0 1000</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TRIGG_DIST&quot;</span>,  4, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _trigg_dist, 0),</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// @Param: RELAY_ON</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// @DisplayName: Relay ON value</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// @Description: This sets whether the relay goes high or low when it triggers. Note that you should also set RELAY_DEFAULT appropriately for your camera</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// @Values: 0:Low,1:High</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RELAY_ON&quot;</span>,    5, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _relay_on, 1),</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// @Param: MIN_INTERVAL</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// @DisplayName: Minimum time between photos</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// @Description: Postpone shooting if previous picture was taken less than preset time(ms) ago.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// @Units: milliseconds</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// @Range: 0 10000</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MIN_INTERVAL&quot;</span>,  6, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _min_interval, 0),</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// @Param: MAX_ROLL</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// @DisplayName: Maximum photo roll angle.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// @Description: Postpone shooting if roll is greater than limit. (0=Disable, will shoot regardless of roll).</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// @Units: Degrees</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// @Range: 0 180</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAX_ROLL&quot;</span>,  7, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _max_roll, 0),</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @Param: FEEDBACK_PIN</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// @DisplayName: Camera feedback pin</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// @Description: pin number to use for save accurate camera feedback messages. If set to -1 then don&#39;t use a pin flag for this, otherwise this is a pin number which if held high after a picture trigger order, will save camera messages when camera really takes a picture. A universal camera hot shoe is needed. The pin should be held high for at least 2 milliseconds for reliable trigger detection. See also the CAM_FEEDBACK_POL option. If using AUX4 pin on a Pixhawk then a fast capture method is used that allows for the trigger time to be as short as one microsecond.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// @Values: -1:Disabled,50:PX4 AUX1,51:PX4 AUX2,52:PX4 AUX3,53:PX4 AUX4(fast capture),54:PX4 AUX5,55:PX4 AUX6</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FEEDBACK_PIN&quot;</span>,  8, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _feedback_pin, <a class="code" href="AP__Camera_8h.html#a57e79bbbed2f08a0f6660c8b7f2cfd8a">AP_CAMERA_FEEDBACK_DEFAULT_FEEDBACK_PIN</a>),</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @Param: FEEDBACK_POL</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @DisplayName: Camera feedback pin polarity</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// @Description: Polarity for feedback pin. If this is 1 then the feedback pin should go high on trigger. If set to 0 then it should go low</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// @Values: 0:TriggerLow,1:TriggerHigh</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FEEDBACK_POL&quot;</span>,  9, <a class="code" href="classAP__Camera.html">AP_Camera</a>, _feedback_polarity, 1),</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;};</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__Camera_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">  static trigger var for PX4 callback</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">volatile</span> <span class="keywordtype">bool</span>   <a class="code" href="classAP__Camera.html#a09b1df0d75659e4abd513cab548e52fc">AP_Camera::_camera_triggered</a>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a336a2fbee20b67e8af153e4bc21bd3fd">  107</a></span>&#160;<a class="code" href="classAP__Camera.html#a336a2fbee20b67e8af153e4bc21bd3fd">AP_Camera::servo_pic</a>()</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;{</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="classSRV__Channels.html#a6ec155ae75e3d22a0de00e21e5b330a9">SRV_Channels::set_output_pwm</a>(<a class="code" href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a4b1e13cf223a7b131ea4c707463921f4">SRV_Channel::k_cam_trigger</a>, <a class="code" href="classAP__Camera.html#af9293b7ef18744e11846fb1ea4440c10">_servo_on_pwm</a>);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// leave a message that it should be active for this many loops (assumes 50hz loops)</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="classAP__Camera.html#a67ac927a0fb87643c1c46c4c13304d17">_trigger_counter</a> = <a class="code" href="AP__Math_8h.html#a68558c4f79a8582543daefde13c64abc">constrain_int16</a>(<a class="code" href="classAP__Camera.html#a54d284e318a74a219ed27f0b3e0c31cb">_trigger_duration</a>*5,0,255);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a73b785894a0650a4dd8b1ffc24c4c250">  117</a></span>&#160;<a class="code" href="classAP__Camera.html#a73b785894a0650a4dd8b1ffc24c4c250">AP_Camera::relay_pic</a>()</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#af1c57b602fc3c83b0c8ffab13bd3163b">_relay_on</a>) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <a class="code" href="classAP__Camera.html#a06d470d983e22c3c87e4295d1c32238c">_apm_relay</a>-&gt;<a class="code" href="classAP__Relay.html#a8f00e5559174917b795ef84472822e53">on</a>(0);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="classAP__Camera.html#a06d470d983e22c3c87e4295d1c32238c">_apm_relay</a>-&gt;<a class="code" href="classAP__Relay.html#aff679a24b3c6b73f066e1e62c86e0fae">off</a>(0);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// leave a message that it should be active for this many loops (assumes 50hz loops)</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="classAP__Camera.html#a67ac927a0fb87643c1c46c4c13304d17">_trigger_counter</a> = <a class="code" href="AP__Math_8h.html#a68558c4f79a8582543daefde13c64abc">constrain_int16</a>(<a class="code" href="classAP__Camera.html#a54d284e318a74a219ed27f0b3e0c31cb">_trigger_duration</a>*5,0,255);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a74372e2b8e5d3cd3b464f2ef417cb0f6">  132</a></span>&#160;<a class="code" href="classAP__Camera.html#a74372e2b8e5d3cd3b464f2ef417cb0f6">AP_Camera::trigger_pic</a>(<span class="keywordtype">bool</span> send_mavlink_msg)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;{</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="classAP__Camera.html#a52203d3c3cc7e420e58c6d0e882f35f4">setup_feedback_callback</a>();</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="classAP__Camera.html#ab0cb6709e2683b25d372e1f1da6a15d1">_image_index</a>++;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classAP__Camera.html#a15e29555e8a25dfcc17b97c37b245536">_trigger_type</a>)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AP__Camera_8h.html#acf9f5a2bd07c05c6fc5a3b5f682a6f82">AP_CAMERA_TRIGGER_TYPE_SERVO</a>:</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="classAP__Camera.html#a336a2fbee20b67e8af153e4bc21bd3fd">servo_pic</a>();                    <span class="comment">// Servo operated camera</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="AP__Camera_8h.html#a882ca1b134a856e7a1986b0068306002">AP_CAMERA_TRIGGER_TYPE_RELAY</a>:</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="classAP__Camera.html#a73b785894a0650a4dd8b1ffc24c4c250">relay_pic</a>();                    <span class="comment">// basic relay activation</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (send_mavlink_msg) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">// create command long mavlink message</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        mavlink_command_long_t cmd_msg;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        memset(&amp;cmd_msg, 0, <span class="keyword">sizeof</span>(cmd_msg));</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        cmd_msg.command = MAV_CMD_DO_DIGICAM_CONTROL;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        cmd_msg.param5 = 1;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// create message</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        mavlink_message_t msg;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        mavlink_msg_command_long_encode(0, 0, &amp;msg, &amp;cmd_msg);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// forward to all components</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="classGCS__MAVLINK.html#a928edfeb8ca8d1656eca3e0c176d49a7">GCS_MAVLINK::send_to_components</a>(&amp;msg);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a3124ce12331fb79e0b68b7067d609be2">  165</a></span>&#160;<a class="code" href="classAP__Camera.html#a3124ce12331fb79e0b68b7067d609be2">AP_Camera::trigger_pic_cleanup</a>()</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;{</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#a67ac927a0fb87643c1c46c4c13304d17">_trigger_counter</a>) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <a class="code" href="classAP__Camera.html#a67ac927a0fb87643c1c46c4c13304d17">_trigger_counter</a>--;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">switch</span> (<a class="code" href="classAP__Camera.html#a15e29555e8a25dfcc17b97c37b245536">_trigger_type</a>) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="AP__Camera_8h.html#acf9f5a2bd07c05c6fc5a3b5f682a6f82">AP_CAMERA_TRIGGER_TYPE_SERVO</a>:</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                <a class="code" href="classSRV__Channels.html#a6ec155ae75e3d22a0de00e21e5b330a9">SRV_Channels::set_output_pwm</a>(<a class="code" href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a4b1e13cf223a7b131ea4c707463921f4">SRV_Channel::k_cam_trigger</a>, <a class="code" href="classAP__Camera.html#a361e9b2bbcaf421a2cd17220ad25ae5c">_servo_off_pwm</a>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="AP__Camera_8h.html#a882ca1b134a856e7a1986b0068306002">AP_CAMERA_TRIGGER_TYPE_RELAY</a>:</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#af1c57b602fc3c83b0c8ffab13bd3163b">_relay_on</a>) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                    <a class="code" href="classAP__Camera.html#a06d470d983e22c3c87e4295d1c32238c">_apm_relay</a>-&gt;<a class="code" href="classAP__Relay.html#aff679a24b3c6b73f066e1e62c86e0fae">off</a>(0);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                    <a class="code" href="classAP__Camera.html#a06d470d983e22c3c87e4295d1c32238c">_apm_relay</a>-&gt;<a class="code" href="classAP__Relay.html#a8f00e5559174917b795ef84472822e53">on</a>(0);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a27664cf70d78d5af17d66a3d715048db">  187</a></span>&#160;<a class="code" href="classAP__Camera.html#a27664cf70d78d5af17d66a3d715048db">AP_Camera::control_msg</a>(mavlink_message_t* msg)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;{</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    __mavlink_digicam_control_t packet;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    mavlink_msg_digicam_control_decode(msg, &amp;packet);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="classAP__Camera.html#a3f1660c56231d66cbaa47ef6e4514f37">control</a>(packet.session, packet.zoom_pos, packet.zoom_step, packet.focus_lock, packet.shot, packet.command_id);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a2ceac45cdd6c13d66052c8168fff689c">  195</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__Camera.html#a2ceac45cdd6c13d66052c8168fff689c">AP_Camera::configure</a>(<span class="keywordtype">float</span> shooting_mode, <span class="keywordtype">float</span> shutter_speed, <span class="keywordtype">float</span> aperture, <span class="keywordtype">float</span> ISO, <span class="keywordtype">float</span> exposure_type, <span class="keywordtype">float</span> cmd_id, <span class="keywordtype">float</span> engine_cutoff_time)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;{</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// we cannot process the configure command so convert to mavlink message</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// and send to all components in case they and process it</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    mavlink_message_t msg;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    mavlink_command_long_t mav_cmd_long = {};</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// convert mission command to mavlink command_long</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    mav_cmd_long.command = MAV_CMD_DO_DIGICAM_CONFIGURE;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    mav_cmd_long.param1 = shooting_mode;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    mav_cmd_long.param2 = shutter_speed;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    mav_cmd_long.param3 = aperture;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    mav_cmd_long.param4 = ISO;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    mav_cmd_long.param5 = exposure_type;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    mav_cmd_long.param6 = cmd_id;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    mav_cmd_long.param7 = engine_cutoff_time;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// Encode Command long into MAVLINK msg</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    mavlink_msg_command_long_encode(0, 0, &amp;msg, &amp;mav_cmd_long);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// send to all components</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="classGCS__MAVLINK.html#a928edfeb8ca8d1656eca3e0c176d49a7">GCS_MAVLINK::send_to_components</a>(&amp;msg);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a3f1660c56231d66cbaa47ef6e4514f37">  220</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Camera.html#a3f1660c56231d66cbaa47ef6e4514f37">AP_Camera::control</a>(<span class="keywordtype">float</span> session, <span class="keywordtype">float</span> zoom_pos, <span class="keywordtype">float</span> zoom_step, <span class="keywordtype">float</span> focus_lock, <span class="keywordtype">float</span> shooting_cmd, <span class="keywordtype">float</span> cmd_id)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;{</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    </div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// take picture</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__Math_8cpp.html#accbd9f8bbc0adacd51efa66fad490c24">is_equal</a>(shooting_cmd,1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="classAP__Camera.html#a74372e2b8e5d3cd3b464f2ef417cb0f6">trigger_pic</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        ret = <span class="keyword">true</span>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    mavlink_message_t msg;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    mavlink_command_long_t mav_cmd_long = {};</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// convert command to mavlink command long</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    mav_cmd_long.command = MAV_CMD_DO_DIGICAM_CONTROL;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    mav_cmd_long.param1 = session;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    mav_cmd_long.param2 = zoom_pos;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    mav_cmd_long.param3 = zoom_step;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    mav_cmd_long.param4 = focus_lock;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    mav_cmd_long.param5 = shooting_cmd;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    mav_cmd_long.param6 = cmd_id;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// Encode Command long into MAVLINK msg</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    mavlink_msg_command_long_encode(0, 0, &amp;msg, &amp;mav_cmd_long);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// send to all components</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="classGCS__MAVLINK.html#a928edfeb8ca8d1656eca3e0c176d49a7">GCS_MAVLINK::send_to_components</a>(&amp;msg);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  Send camera feedback to the GCS</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="classAP__Camera.html#ada4a3f88906024b90555c5e0805752df">  253</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__Camera.html#ada4a3f88906024b90555c5e0805752df">AP_Camera::send_feedback</a>(mavlink_channel_t chan, <a class="code" href="classAP__GPS.html">AP_GPS</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>, <span class="keyword">const</span> <a class="code" href="classAP__AHRS.html">AP_AHRS</a> &amp;<a class="code" href="ModuleTest_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>, <span class="keyword">const</span> <a class="code" href="structLocation.html">Location</a> &amp;current_loc)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">float</span> altitude, altitude_rel;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (current_loc.<a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a>.<a class="code" href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">relative_alt</a>) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        altitude = current_loc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>+ahrs.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        altitude_rel = current_loc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        altitude = current_loc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        altitude_rel = current_loc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - ahrs.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    mavlink_msg_camera_feedback_send(chan, </div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        gps.<a class="code" href="classAP__GPS.html#a199daa774fba57b608c0a245e70c46d5">time_epoch_usec</a>(),</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        0, 0, <a class="code" href="classAP__Camera.html#ab0cb6709e2683b25d372e1f1da6a15d1">_image_index</a>,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        current_loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>, current_loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        altitude/100.0f, altitude_rel/100.0f,</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        ahrs.<a class="code" href="classAP__AHRS.html#a0c6e82280b005a339b04028b1f5ea70d">roll_sensor</a>/100.0f, ahrs.<a class="code" href="classAP__AHRS.html#af3394de208d1f96457382d79ab7a8d01">pitch_sensor</a>/100.0f, ahrs.<a class="code" href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">yaw_sensor</a>/100.0f,</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        0.0f,CAMERA_FEEDBACK_PHOTO);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">/*  update location, for triggering by GPS distance moved</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">    This function returns true if a picture should be taken</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">    The caller is responsible for taking the picture based on the return value of this function.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">    The caller is also responsible for logging the details about the photo</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="classAP__Camera.html#ae4a650d1b1ce924ef7745813af80b103">  279</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Camera.html#ae4a650d1b1ce924ef7745813af80b103">AP_Camera::update_location</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structLocation.html">Location</a> &amp;loc, <span class="keyword">const</span> <a class="code" href="classAP__AHRS.html">AP_AHRS</a> &amp;<a class="code" href="ModuleTest_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code" href="classAP__Camera.html#acd2e6ad4afc2f7f0acb4410ce89588fb">_trigg_dist</a>)) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a>.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> == 0 &amp;&amp; <a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a>.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> == 0) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a> = loc;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a>.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> == loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> &amp;&amp; <a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a>.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> == loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="comment">// we haven&#39;t moved - this can happen as update_location() may</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment">// be called without a new GPS fix</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="location_8cpp.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a>(loc, <a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a>) &lt; <a class="code" href="classAP__Camera.html#acd2e6ad4afc2f7f0acb4410ce89588fb">_trigg_dist</a>) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#a295bd80572d11ca8249e941156fb4d79">_max_roll</a> &gt; 0 &amp;&amp; labs(ahrs.<a class="code" href="classAP__AHRS.html#a0c6e82280b005a339b04028b1f5ea70d">roll_sensor</a>/100) &gt; <a class="code" href="classAP__Camera.html#a295bd80572d11ca8249e941156fb4d79">_max_roll</a>) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    uint32_t tnow = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (tnow - <a class="code" href="classAP__Camera.html#aa83e6de0ce7ffb3a880f31875786c83e">_last_photo_time</a> &lt; (<span class="keywordtype">unsigned</span>) <a class="code" href="classAP__Camera.html#ae1ec9b401704bee2cb92fb1069c9660f">_min_interval</a>) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <a class="code" href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">_last_location</a> = loc;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="classAP__Camera.html#aa83e6de0ce7ffb3a880f31875786c83e">_last_photo_time</a> = tnow;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">  check if feedback pin is high</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00315"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a238c424e3b23b41e513efeaa1ee7f3ea">  315</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__Camera.html#a238c424e3b23b41e513efeaa1ee7f3ea">AP_Camera::feedback_pin_timer</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;{</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    int8_t dpin = hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a9671bdb28184ecdf95959ff3d6b5b4bb">analogPinToDigitalPin</a>(<a class="code" href="classAP__Camera.html#a6fe0e97104b36fb59aeb4bde622892d8">_feedback_pin</a>);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (dpin == -1) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// ensure we are in input mode</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">pinMode</a>(dpin, <a class="code" href="GPIO_8h.html#af4f5e2024972dc555e998dde1bd151bf">HAL_GPIO_INPUT</a>);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// enable pullup</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">write</a>(dpin, 1);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    uint8_t pin_state = hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a453e2829832c783a5337849218390efc">read</a>(dpin);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    uint8_t trigger_polarity = <a class="code" href="classAP__Camera.html#a41a3d903754676a97ec482f2139cb434">_feedback_polarity</a>==0?0:1;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (pin_state == trigger_polarity &amp;&amp;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <a class="code" href="classAP__Camera.html#a3c03e7a8be30484a2437b68e5dd7145d">_last_pin_state</a> != trigger_polarity) {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="classAP__Camera.html#a09b1df0d75659e4abd513cab548e52fc">_camera_triggered</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="classAP__Camera.html#a3c03e7a8be30484a2437b68e5dd7145d">_last_pin_state</a> = pin_state;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">  check if camera has triggered</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a3cb8b61c4bf56b7b46c14981d131de84">  339</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Camera.html#a3cb8b61c4bf56b7b46c14981d131de84">AP_Camera::check_trigger_pin</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;{</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#a09b1df0d75659e4abd513cab548e52fc">_camera_triggered</a>) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <a class="code" href="classAP__Camera.html#a09b1df0d75659e4abd513cab548e52fc">_camera_triggered</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_PX4</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">  callback for timer capture on PX4</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="classAP__Camera.html#abb05c4088505624ce988709a153553c9">  352</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__Camera.html#abb05c4088505624ce988709a153553c9">AP_Camera::capture_callback</a>(<span class="keywordtype">void</span> *context, uint32_t chan_index,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                 hrt_abstime edge_time, uint32_t edge_state, uint32_t overflow)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="classAP__Camera.html#a09b1df0d75659e4abd513cab548e52fc">_camera_triggered</a> = <span class="keyword">true</span>;    </div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">  setup a callback for a feedback pin. When on PX4 with the right FMU</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">  mode we can use the microsecond timer.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="classAP__Camera.html#a52203d3c3cc7e420e58c6d0e882f35f4">  363</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__Camera.html#a52203d3c3cc7e420e58c6d0e882f35f4">AP_Camera::setup_feedback_callback</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#a6fe0e97104b36fb59aeb4bde622892d8">_feedback_pin</a> &lt;= 0 || <a class="code" href="classAP__Camera.html#a60d7ab95f6e3e059b7d4212a69f6e6ec">_timer_installed</a>) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment">// invalid or already installed</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_PX4</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">      special case for pin 53 on PX4. We can use the fast timer support</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Camera.html#a6fe0e97104b36fb59aeb4bde622892d8">_feedback_pin</a> == 53) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordtype">int</span> fd = open(<span class="stringliteral">&quot;/dev/px4fmu&quot;</span>, 0);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span> (fd != -1) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">if</span> (ioctl(fd, PWM_SERVO_SET_MODE, PWM_SERVO_MODE_3PWM1CAP) != 0) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_WARNING, <span class="stringliteral">&quot;Camera: unable to setup 3PWM1CAP\n&quot;</span>);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                close(fd);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="keywordflow">goto</span> failed;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            }   </div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">if</span> (up_input_capture_set(3, <a class="code" href="classAP__Camera.html#a41a3d903754676a97ec482f2139cb434">_feedback_polarity</a>==1?Rising:Falling, 0, <a class="code" href="classAP__Camera.html#abb05c4088505624ce988709a153553c9">capture_callback</a>, <span class="keyword">this</span>) != 0) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_WARNING, <span class="stringliteral">&quot;Camera: unable to setup timer capture\n&quot;</span>);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                close(fd);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                <span class="keywordflow">goto</span> failed;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            close(fd);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <a class="code" href="classAP__Camera.html#a60d7ab95f6e3e059b7d4212a69f6e6ec">_timer_installed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_WARNING, <span class="stringliteral">&quot;Camera: setup fast trigger capture\n&quot;</span>);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;failed:</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="preprocessor">#endif // CONFIG_HAL_BOARD</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__Camera.html#a60d7ab95f6e3e059b7d4212a69f6e6ec">_timer_installed</a>) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">// install a 1kHz timer to check feedback pin</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ac2c4230957d5dbd3c2fd104af2794b4f">register_timer_process</a>(<a class="code" href="functor_8h.html#a00e5874203cecc310017f9166f2c0e36">FUNCTOR_BIND_MEMBER</a>(&amp;<a class="code" href="classAP__Camera.html#a238c424e3b23b41e513efeaa1ee7f3ea">AP_Camera::feedback_pin_timer</a>, <span class="keywordtype">void</span>));</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="classAP__Camera.html#a60d7ab95f6e3e059b7d4212a69f6e6ec">_timer_installed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div><div class="ttc" id="classAP__GPS_html"><div class="ttname"><a href="classAP__GPS.html">AP_GPS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00047">AP_GPS.h:47</a></div></div>
<div class="ttc" id="classAP__Camera_html_af9293b7ef18744e11846fb1ea4440c10"><div class="ttname"><a href="classAP__Camera.html#af9293b7ef18744e11846fb1ea4440c10">AP_Camera::_servo_on_pwm</a></div><div class="ttdeci">AP_Int16 _servo_on_pwm</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00079">AP_Camera.h:79</a></div></div>
<div class="ttc" id="classAP__Camera_html_a60d7ab95f6e3e059b7d4212a69f6e6ec"><div class="ttname"><a href="classAP__Camera.html#a60d7ab95f6e3e059b7d4212a69f6e6ec">AP_Camera::_timer_installed</a></div><div class="ttdeci">bool _timer_installed</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00106">AP_Camera.h:106</a></div></div>
<div class="ttc" id="classAP__HAL_1_1GPIO_html_a9671bdb28184ecdf95959ff3d6b5b4bb"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a9671bdb28184ecdf95959ff3d6b5b4bb">AP_HAL::GPIO::analogPinToDigitalPin</a></div><div class="ttdeci">virtual int8_t analogPinToDigitalPin(uint8_t pin)=0</div></div>
<div class="ttc" id="classAP__Camera_html_a295bd80572d11ca8249e941156fb4d79"><div class="ttname"><a href="classAP__Camera.html#a295bd80572d11ca8249e941156fb4d79">AP_Camera::_max_roll</a></div><div class="ttdeci">AP_Int16 _max_roll</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00095">AP_Camera.h:95</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a68558c4f79a8582543daefde13c64abc"><div class="ttname"><a href="AP__Math_8h.html#a68558c4f79a8582543daefde13c64abc">constrain_int16</a></div><div class="ttdeci">int16_t constrain_int16(const int16_t amt, const int16_t low, const int16_t high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00124">AP_Math.h:124</a></div></div>
<div class="ttc" id="classGCS__MAVLINK_html_ae1d5ebd46ec3ddb644862c747e2968bf"><div class="ttname"><a href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a></div><div class="ttdeci">static void send_statustext_all(MAV_SEVERITY severity, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Common_8cpp_source.html#l01322">GCS_Common.cpp:1322</a></div></div>
<div class="ttc" id="AP__Camera_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__Camera_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00010">AC_PID_test.cpp:10</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="classAP__Camera_html_a3f1660c56231d66cbaa47ef6e4514f37"><div class="ttname"><a href="classAP__Camera.html#a3f1660c56231d66cbaa47ef6e4514f37">AP_Camera::control</a></div><div class="ttdeci">bool control(float session, float zoom_pos, float zoom_step, float focus_lock, float shooting_cmd, float cmd_id)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00220">AP_Camera.cpp:220</a></div></div>
<div class="ttc" id="classAP__Camera_html_a3c03e7a8be30484a2437b68e5dd7145d"><div class="ttname"><a href="classAP__Camera.html#a3c03e7a8be30484a2437b68e5dd7145d">AP_Camera::_last_pin_state</a></div><div class="ttdeci">uint8_t _last_pin_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00107">AP_Camera.h:107</a></div></div>
<div class="ttc" id="classAP__Camera_html_a09b1df0d75659e4abd513cab548e52fc"><div class="ttname"><a href="classAP__Camera.html#a09b1df0d75659e4abd513cab548e52fc">AP_Camera::_camera_triggered</a></div><div class="ttdeci">static volatile bool _camera_triggered</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00105">AP_Camera.h:105</a></div></div>
<div class="ttc" id="classAP__Camera_html_a238c424e3b23b41e513efeaa1ee7f3ea"><div class="ttname"><a href="classAP__Camera.html#a238c424e3b23b41e513efeaa1ee7f3ea">AP_Camera::feedback_pin_timer</a></div><div class="ttdeci">void feedback_pin_timer()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00315">AP_Camera.cpp:315</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00087">AP_Param.h:87</a></div></div>
<div class="ttc" id="location_8cpp_html_aa825a788804b8dd4cf1e3cfb42960a8b"><div class="ttname"><a href="location_8cpp.html#aa825a788804b8dd4cf1e3cfb42960a8b">get_distance</a></div><div class="ttdeci">float get_distance(const struct Location &amp;loc1, const struct Location &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="location_8cpp_source.html#l00052">location.cpp:52</a></div></div>
<div class="ttc" id="classAP__Camera_html_af1c57b602fc3c83b0c8ffab13bd3163b"><div class="ttname"><a href="classAP__Camera.html#af1c57b602fc3c83b0c8ffab13bd3163b">AP_Camera::_relay_on</a></div><div class="ttdeci">AP_Int8 _relay_on</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00078">AP_Camera.h:78</a></div></div>
<div class="ttc" id="fcntl_8h_html"><div class="ttname"><a href="fcntl_8h.html">fcntl.h</a></div></div>
<div class="ttc" id="classAP__AHRS_html"><div class="ttname"><a href="classAP__AHRS.html">AP_AHRS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00050">AP_AHRS.h:50</a></div></div>
<div class="ttc" id="classAP__Relay_html_aff679a24b3c6b73f066e1e62c86e0fae"><div class="ttname"><a href="classAP__Relay.html#aff679a24b3c6b73f066e1e62c86e0fae">AP_Relay::off</a></div><div class="ttdeci">void off(uint8_t relay)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Relay_8cpp_source.html#l00109">AP_Relay.cpp:109</a></div></div>
<div class="ttc" id="classAP__Camera_html_ada4a3f88906024b90555c5e0805752df"><div class="ttname"><a href="classAP__Camera.html#ada4a3f88906024b90555c5e0805752df">AP_Camera::send_feedback</a></div><div class="ttdeci">void send_feedback(mavlink_channel_t chan, AP_GPS &amp;gps, const AP_AHRS &amp;ahrs, const Location &amp;current_loc)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00253">AP_Camera.cpp:253</a></div></div>
<div class="ttc" id="classAP__Camera_html_a67ac927a0fb87643c1c46c4c13304d17"><div class="ttname"><a href="classAP__Camera.html#a67ac927a0fb87643c1c46c4c13304d17">AP_Camera::_trigger_counter</a></div><div class="ttdeci">uint8_t _trigger_counter</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00081">AP_Camera.h:81</a></div></div>
<div class="ttc" id="classSRV__Channel_html_a9ca1754fc905dddeebec41568a475d68a4b1e13cf223a7b131ea4c707463921f4"><div class="ttname"><a href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a4b1e13cf223a7b131ea4c707463921f4">SRV_Channel::k_cam_trigger</a></div><div class="ttdoc">camera trigger </div><div class="ttdef"><b>Definition:</b> <a href="SRV__Channel_8h_source.html#l00050">SRV_Channel.h:50</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_a1ccb29b0c458e967baa34127677cd15b"><div class="ttname"><a href="AP__Camera_8h.html#a1ccb29b0c458e967baa34127677cd15b">AP_CAMERA_TRIGGER_DEFAULT_TRIGGER_TYPE</a></div><div class="ttdeci">#define AP_CAMERA_TRIGGER_DEFAULT_TRIGGER_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00020">AP_Camera.h:20</a></div></div>
<div class="ttc" id="ModuleTest_8cpp_html_a0a15280249072432f8c559cc00d09dee"><div class="ttname"><a href="ModuleTest_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a></div><div class="ttdeci">AP_AHRS_DCM ahrs(ins, baro, gps)</div></div>
<div class="ttc" id="classAP__HAL_1_1GPIO_html_a2b0664bdab1876e3b0bbcd9064eec88e"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">AP_HAL::GPIO::write</a></div><div class="ttdeci">virtual void write(uint8_t pin, uint8_t value)=0</div></div>
<div class="ttc" id="structLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdoc">param 3 - Latitude * 10**7 </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00129">AP_Common.h:129</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a0c6e82280b005a339b04028b1f5ea70d"><div class="ttname"><a href="classAP__AHRS.html#a0c6e82280b005a339b04028b1f5ea70d">AP_AHRS::roll_sensor</a></div><div class="ttdeci">int32_t roll_sensor</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00231">AP_AHRS.h:231</a></div></div>
<div class="ttc" id="classAP__Camera_html_a41a3d903754676a97ec482f2139cb434"><div class="ttname"><a href="classAP__Camera.html#a41a3d903754676a97ec482f2139cb434">AP_Camera::_feedback_polarity</a></div><div class="ttdeci">AP_Int8 _feedback_polarity</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00102">AP_Camera.h:102</a></div></div>
<div class="ttc" id="classAP__Camera_html_a6fe0e97104b36fb59aeb4bde622892d8"><div class="ttname"><a href="classAP__Camera.html#a6fe0e97104b36fb59aeb4bde622892d8">AP_Camera::_feedback_pin</a></div><div class="ttdeci">AP_Int8 _feedback_pin</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00101">AP_Camera.h:101</a></div></div>
<div class="ttc" id="classAP__Camera_html_aa3a20cb5ec2e86ac69d02e67954d8c6a"><div class="ttname"><a href="classAP__Camera.html#aa3a20cb5ec2e86ac69d02e67954d8c6a">AP_Camera::_last_location</a></div><div class="ttdeci">struct Location _last_location</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00097">AP_Camera.h:97</a></div></div>
<div class="ttc" id="classAP__AHRS_html_aea45b16e6469a3b392b8bf52fb864732"><div class="ttname"><a href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">AP_AHRS::get_home</a></div><div class="ttdeci">const struct Location &amp; get_home(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00430">AP_AHRS.h:430</a></div></div>
<div class="ttc" id="classAP__Relay_html_a8f00e5559174917b795ef84472822e53"><div class="ttname"><a href="classAP__Relay.html#a8f00e5559174917b795ef84472822e53">AP_Relay::on</a></div><div class="ttdeci">void on(uint8_t relay)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Relay_8cpp_source.html#l00100">AP_Relay.cpp:100</a></div></div>
<div class="ttc" id="classAP__Camera_html_a15e29555e8a25dfcc17b97c37b245536"><div class="ttname"><a href="classAP__Camera.html#a15e29555e8a25dfcc17b97c37b245536">AP_Camera::_trigger_type</a></div><div class="ttdeci">AP_Int8 _trigger_type</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00076">AP_Camera.h:76</a></div></div>
<div class="ttc" id="classGCS__MAVLINK_html_a928edfeb8ca8d1656eca3e0c176d49a7"><div class="ttname"><a href="classGCS__MAVLINK.html#a928edfeb8ca8d1656eca3e0c176d49a7">GCS_MAVLINK::send_to_components</a></div><div class="ttdeci">static void send_to_components(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="GCS_8h_source.html#l00183">GCS.h:183</a></div></div>
<div class="ttc" id="classAP__Camera_html_a54d284e318a74a219ed27f0b3e0c31cb"><div class="ttname"><a href="classAP__Camera.html#a54d284e318a74a219ed27f0b3e0c31cb">AP_Camera::_trigger_duration</a></div><div class="ttdeci">AP_Int8 _trigger_duration</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00077">AP_Camera.h:77</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00018">HAL.h:18</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_a02e6f5dab509e2d0ab6fb1157a4a305f"><div class="ttname"><a href="AP__Camera_8h.html#a02e6f5dab509e2d0ab6fb1157a4a305f">AP_CAMERA_SERVO_OFF_PWM</a></div><div class="ttdeci">#define AP_CAMERA_SERVO_OFF_PWM</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00025">AP_Camera.h:25</a></div></div>
<div class="ttc" id="structLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdoc">param 2 - Altitude in centimeters (meters * 100) see LOCATION_ALT_MAX_M </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00128">AP_Common.h:128</a></div></div>
<div class="ttc" id="classAP__AHRS_html_af3394de208d1f96457382d79ab7a8d01"><div class="ttname"><a href="classAP__AHRS.html#af3394de208d1f96457382d79ab7a8d01">AP_AHRS::pitch_sensor</a></div><div class="ttdeci">int32_t pitch_sensor</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00232">AP_AHRS.h:232</a></div></div>
<div class="ttc" id="classAP__Camera_html"><div class="ttname"><a href="classAP__Camera.html">AP_Camera</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00031">AP_Camera.h:31</a></div></div>
<div class="ttc" id="RC__Channel_8h_html"><div class="ttname"><a href="RC__Channel_8h.html">RC_Channel.h</a></div><div class="ttdoc">RC_Channel manager, with EEPROM-backed storage of constants. </div></div>
<div class="ttc" id="classAP__Camera_html_a0819e25b3f6e6c173f25842dbfd8d50c"><div class="ttname"><a href="classAP__Camera.html#a0819e25b3f6e6c173f25842dbfd8d50c">AP_Camera::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00073">AP_Camera.h:73</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00039">AP_Math.h:39</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classSRV__Channels_html_a6ec155ae75e3d22a0de00e21e5b330a9"><div class="ttname"><a href="classSRV__Channels.html#a6ec155ae75e3d22a0de00e21e5b330a9">SRV_Channels::set_output_pwm</a></div><div class="ttdeci">static void set_output_pwm(SRV_Channel::Aux_servo_function_t function, uint16_t value)</div><div class="ttdef"><b>Definition:</b> <a href="SRV__Channel__aux_8cpp_source.html#l00161">SRV_Channel_aux.cpp:161</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="AP__HAL__Linux_2system_8cpp_source.html#l00043">system.cpp:43</a></div></div>
<div class="ttc" id="classAP__Camera_html_a2ceac45cdd6c13d66052c8168fff689c"><div class="ttname"><a href="classAP__Camera.html#a2ceac45cdd6c13d66052c8168fff689c">AP_Camera::configure</a></div><div class="ttdeci">void configure(float shooting_mode, float shutter_speed, float aperture, float ISO, float exposure_type, float cmd_id, float engine_cutoff_time)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00195">AP_Camera.cpp:195</a></div></div>
<div class="ttc" id="classAP__Camera_html_acd2e6ad4afc2f7f0acb4410ce89588fb"><div class="ttname"><a href="classAP__Camera.html#acd2e6ad4afc2f7f0acb4410ce89588fb">AP_Camera::_trigg_dist</a></div><div class="ttdeci">AP_Float _trigg_dist</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00093">AP_Camera.h:93</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00126">AP_Param.h:126</a></div></div>
<div class="ttc" id="classAP__Camera_html_abb05c4088505624ce988709a153553c9"><div class="ttname"><a href="classAP__Camera.html#abb05c4088505624ce988709a153553c9">AP_Camera::capture_callback</a></div><div class="ttdeci">static void capture_callback(void *context, uint32_t chan_index, hrt_abstime edge_time, uint32_t edge_state, uint32_t overflow)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00352">AP_Camera.cpp:352</a></div></div>
<div class="ttc" id="classAP__HAL_1_1GPIO_html_a3dfc60214bd1aa4936d51ca72c045b95"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">AP_HAL::GPIO::pinMode</a></div><div class="ttdeci">virtual void pinMode(uint8_t pin, uint8_t output)=0</div></div>
<div class="ttc" id="classAP__Camera_html_aa83e6de0ce7ffb3a880f31875786c83e"><div class="ttname"><a href="classAP__Camera.html#aa83e6de0ce7ffb3a880f31875786c83e">AP_Camera::_last_photo_time</a></div><div class="ttdeci">uint32_t _last_photo_time</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00096">AP_Camera.h:96</a></div></div>
<div class="ttc" id="AP__Math_8h_html"><div class="ttname"><a href="AP__Math_8h.html">AP_Math.h</a></div></div>
<div class="ttc" id="classAP__Camera_html_a3cb8b61c4bf56b7b46c14981d131de84"><div class="ttname"><a href="classAP__Camera.html#a3cb8b61c4bf56b7b46c14981d131de84">AP_Camera::check_trigger_pin</a></div><div class="ttdeci">bool check_trigger_pin(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00339">AP_Camera.cpp:339</a></div></div>
<div class="ttc" id="classAP__Camera_html_a336a2fbee20b67e8af153e4bc21bd3fd"><div class="ttname"><a href="classAP__Camera.html#a336a2fbee20b67e8af153e4bc21bd3fd">AP_Camera::servo_pic</a></div><div class="ttdeci">void servo_pic()</div><div class="ttdoc">Servo operated camera. </div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00107">AP_Camera.cpp:107</a></div></div>
<div class="ttc" id="structLocation_html_ad9759dba1fc13f13c531ebdcb2c9588e"><div class="ttname"><a href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">Location::flags</a></div><div class="ttdeci">Location_Option_Flags flags</div><div class="ttdoc">options bitmask (1&lt;&lt;0 = relative altitude) </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00121">AP_Common.h:121</a></div></div>
<div class="ttc" id="classAP__Camera_html_ae1ec9b401704bee2cb92fb1069c9660f"><div class="ttname"><a href="classAP__Camera.html#ae1ec9b401704bee2cb92fb1069c9660f">AP_Camera::_min_interval</a></div><div class="ttdeci">AP_Int16 _min_interval</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00094">AP_Camera.h:94</a></div></div>
<div class="ttc" id="classAP__Camera_html_a27664cf70d78d5af17d66a3d715048db"><div class="ttname"><a href="classAP__Camera.html#a27664cf70d78d5af17d66a3d715048db">AP_Camera::control_msg</a></div><div class="ttdeci">void control_msg(mavlink_message_t *msg)</div><div class="ttdoc">decode deprecated MavLink message that controls camera. </div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00187">AP_Camera.cpp:187</a></div></div>
<div class="ttc" id="GPIO_8h_html_af4f5e2024972dc555e998dde1bd151bf"><div class="ttname"><a href="GPIO_8h.html#af4f5e2024972dc555e998dde1bd151bf">HAL_GPIO_INPUT</a></div><div class="ttdeci">#define HAL_GPIO_INPUT</div><div class="ttdef"><b>Definition:</b> <a href="GPIO_8h_source.html#l00007">GPIO.h:7</a></div></div>
<div class="ttc" id="classAP__Camera_html_a3124ce12331fb79e0b68b7067d609be2"><div class="ttname"><a href="classAP__Camera.html#a3124ce12331fb79e0b68b7067d609be2">AP_Camera::trigger_pic_cleanup</a></div><div class="ttdeci">void trigger_pic_cleanup()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00165">AP_Camera.cpp:165</a></div></div>
<div class="ttc" id="classAP__Camera_html_a73b785894a0650a4dd8b1ffc24c4c250"><div class="ttname"><a href="classAP__Camera.html#a73b785894a0650a4dd8b1ffc24c4c250">AP_Camera::relay_pic</a></div><div class="ttdeci">void relay_pic()</div><div class="ttdoc">basic relay activation </div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00117">AP_Camera.cpp:117</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_a882ca1b134a856e7a1986b0068306002"><div class="ttname"><a href="AP__Camera_8h.html#a882ca1b134a856e7a1986b0068306002">AP_CAMERA_TRIGGER_TYPE_RELAY</a></div><div class="ttdeci">#define AP_CAMERA_TRIGGER_TYPE_RELAY</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00018">AP_Camera.h:18</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Scheduler_html_ac2c4230957d5dbd3c2fd104af2794b4f"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#ac2c4230957d5dbd3c2fd104af2794b4f">AP_HAL::Scheduler::register_timer_process</a></div><div class="ttdeci">virtual void register_timer_process(AP_HAL::MemberProc)=0</div></div>
<div class="ttc" id="classAP__HAL_1_1GPIO_html_a453e2829832c783a5337849218390efc"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a453e2829832c783a5337849218390efc">AP_HAL::GPIO::read</a></div><div class="ttdeci">virtual uint8_t read(uint8_t pin)=0</div></div>
<div class="ttc" id="classAP__GPS_html_a199daa774fba57b608c0a245e70c46d5"><div class="ttname"><a href="classAP__GPS.html#a199daa774fba57b608c0a245e70c46d5">AP_GPS::time_epoch_usec</a></div><div class="ttdeci">uint64_t time_epoch_usec(uint8_t instance)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00338">AP_GPS.cpp:338</a></div></div>
<div class="ttc" id="structLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdoc">param 4 - Longitude * 10**7 </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00130">AP_Common.h:130</a></div></div>
<div class="ttc" id="classAP__Camera_html_ae4a650d1b1ce924ef7745813af80b103"><div class="ttname"><a href="classAP__Camera.html#ae4a650d1b1ce924ef7745813af80b103">AP_Camera::update_location</a></div><div class="ttdeci">bool update_location(const struct Location &amp;loc, const AP_AHRS &amp;ahrs)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00279">AP_Camera.cpp:279</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_a57e79bbbed2f08a0f6660c8b7f2cfd8a"><div class="ttname"><a href="AP__Camera_8h.html#a57e79bbbed2f08a0f6660c8b7f2cfd8a">AP_CAMERA_FEEDBACK_DEFAULT_FEEDBACK_PIN</a></div><div class="ttdeci">#define AP_CAMERA_FEEDBACK_DEFAULT_FEEDBACK_PIN</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00027">AP_Camera.h:27</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_accbd9f8bbc0adacd51efa66fad490c24"><div class="ttname"><a href="AP__Math_8cpp.html#accbd9f8bbc0adacd51efa66fad490c24">is_equal</a></div><div class="ttdeci">std::enable_if&lt; std::is_integral&lt; typename std::common_type&lt; Arithmetic1, Arithmetic2 &gt;::type &gt;::value,bool &gt;::type is_equal(const Arithmetic1 v_1, const Arithmetic2 v_2)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00012">AP_Math.cpp:12</a></div></div>
<div class="ttc" id="classAP__Camera_html_a361e9b2bbcaf421a2cd17220ad25ae5c"><div class="ttname"><a href="classAP__Camera.html#a361e9b2bbcaf421a2cd17220ad25ae5c">AP_Camera::_servo_off_pwm</a></div><div class="ttdeci">AP_Int16 _servo_off_pwm</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00080">AP_Camera.h:80</a></div></div>
<div class="ttc" id="classAP__Camera_html_a06d470d983e22c3c87e4295d1c32238c"><div class="ttname"><a href="classAP__Camera.html#a06d470d983e22c3c87e4295d1c32238c">AP_Camera::_apm_relay</a></div><div class="ttdeci">AP_Relay * _apm_relay</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00082">AP_Camera.h:82</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a13ed800ad745085097f4d6dce9070eb0"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">AP_HAL::HAL::gpio</a></div><div class="ttdeci">AP_HAL::GPIO * gpio</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00090">HAL.h:90</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_a77e9f793badf723626ba9cc8447f3e58"><div class="ttname"><a href="AP__Camera_8h.html#a77e9f793badf723626ba9cc8447f3e58">AP_CAMERA_TRIGGER_DEFAULT_DURATION</a></div><div class="ttdeci">#define AP_CAMERA_TRIGGER_DEFAULT_DURATION</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00022">AP_Camera.h:22</a></div></div>
<div class="ttc" id="functor_8h_html_a00e5874203cecc310017f9166f2c0e36"><div class="ttname"><a href="functor_8h.html#a00e5874203cecc310017f9166f2c0e36">FUNCTOR_BIND_MEMBER</a></div><div class="ttdeci">#define FUNCTOR_BIND_MEMBER(func, rettype,...)</div><div class="ttdef"><b>Definition:</b> <a href="functor_8h_source.html#l00031">functor.h:31</a></div></div>
<div class="ttc" id="AHRS__Test_8cpp_html_a962e3f0f8682f6dedb5a001a70bdd65e"><div class="ttname"><a href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a></div><div class="ttdeci">AP_GPS gps</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8cpp_source.html#l00018">AHRS_Test.cpp:18</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_acf9f5a2bd07c05c6fc5a3b5f682a6f82"><div class="ttname"><a href="AP__Camera_8h.html#acf9f5a2bd07c05c6fc5a3b5f682a6f82">AP_CAMERA_TRIGGER_TYPE_SERVO</a></div><div class="ttdeci">#define AP_CAMERA_TRIGGER_TYPE_SERVO</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00017">AP_Camera.h:17</a></div></div>
<div class="ttc" id="AP__Camera_8h_html_adb9fdb00ca2e2319ea1dc5dd6ab92f91"><div class="ttname"><a href="AP__Camera_8h.html#adb9fdb00ca2e2319ea1dc5dd6ab92f91">AP_CAMERA_SERVO_ON_PWM</a></div><div class="ttdeci">#define AP_CAMERA_SERVO_ON_PWM</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00024">AP_Camera.h:24</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a8a160130dd99016a19abab9d85917261"><div class="ttname"><a href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">AP_AHRS::yaw_sensor</a></div><div class="ttdeci">int32_t yaw_sensor</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00233">AP_AHRS.h:233</a></div></div>
<div class="ttc" id="AP__Camera_8h_html"><div class="ttname"><a href="AP__Camera_8h.html">AP_Camera.h</a></div><div class="ttdoc">Photo or video camera manager, with EEPROM-backed storage of constants. </div></div>
<div class="ttc" id="classAP__Camera_html_a74372e2b8e5d3cd3b464f2ef417cb0f6"><div class="ttname"><a href="classAP__Camera.html#a74372e2b8e5d3cd3b464f2ef417cb0f6">AP_Camera::trigger_pic</a></div><div class="ttdeci">void trigger_pic(bool send_mavlink_msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00132">AP_Camera.cpp:132</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00102">AP_Param.h:102</a></div></div>
<div class="ttc" id="AP__Relay_8h_html"><div class="ttname"><a href="AP__Relay_8h.html">AP_Relay.h</a></div><div class="ttdoc">APM relay control class. </div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00093">HAL.h:93</a></div></div>
<div class="ttc" id="classAP__Camera_html_a52203d3c3cc7e420e58c6d0e882f35f4"><div class="ttname"><a href="classAP__Camera.html#a52203d3c3cc7e420e58c6d0e882f35f4">AP_Camera::setup_feedback_callback</a></div><div class="ttdeci">void setup_feedback_callback(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8cpp_source.html#l00363">AP_Camera.cpp:363</a></div></div>
<div class="ttc" id="structLocation__Option__Flags_html_a3f0f17e655550917bc3177e876d6dc14"><div class="ttname"><a href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">Location_Option_Flags::relative_alt</a></div><div class="ttdeci">uint8_t relative_alt</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00111">AP_Common.h:111</a></div></div>
<div class="ttc" id="structLocation_html"><div class="ttname"><a href="structLocation.html">Location</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00119">AP_Common.h:119</a></div></div>
<div class="ttc" id="classAP__Camera_html_ab0cb6709e2683b25d372e1f1da6a15d1"><div class="ttname"><a href="classAP__Camera.html#ab0cb6709e2683b25d372e1f1da6a15d1">AP_Camera::_image_index</a></div><div class="ttdeci">uint16_t _image_index</div><div class="ttdef"><b>Definition:</b> <a href="AP__Camera_8h_source.html#l00098">AP_Camera.h:98</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 14 2017 11:51:10 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
