<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>APM:Libraries: libraries/AP_AdvancedFailsafe/AP_AdvancedFailsafe.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_780c6d813aaeceda581ce834ab8f1329.html">AP_AdvancedFailsafe</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_AdvancedFailsafe.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__AdvancedFailsafe_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">   This program is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">   it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   (at your option) any later version.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">   This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">   GNU General Public License for more details.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">   You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">    AP_AdvancedFailsafe.cpp</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">    This is an advanced failsafe module originally modelled on the</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">    failsafe rules of the Outback Challenge</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__AdvancedFailsafe_8h.html">AP_AdvancedFailsafe.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="RC__Channel_8h.html">RC_Channel/RC_Channel.h</a>&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="SRV__Channel_8h.html">SRV_Channel/SRV_Channel.h</a>&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__AdvancedFailsafe_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// table of user settable parameters</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__AdvancedFailsafe.html#a6826fdda1754d300e115690327835fae">AP_AdvancedFailsafe::var_info</a>[] = {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// @Param: ENABLE</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// @DisplayName: Enable Advanced Failsafe</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// @Description: This enables the advanced failsafe system. If this is set to zero (disable) then all the other AFS options have no effect</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="AP__Param_8h.html#ac24e2eb16c2194e975d27e47ddcb7f1c">AP_GROUPINFO_FLAGS</a>(<span class="stringliteral">&quot;ENABLE&quot;</span>,       11, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _enable, 0, <a class="code" href="AP__Param_8h.html#ae25c1c7495435989f8be5781c86be078">AP_PARAM_FLAG_ENABLE</a>),</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// @Param: MAN_PIN</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// @DisplayName: Manual Pin</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// @Description: This sets a digital output pin to set high when in manual mode</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAN_PIN&quot;</span>,     0, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _manual_pin,    -1),</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// @Param: HB_PIN</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// @DisplayName: Heartbeat Pin</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// @Description: This sets a digital output pin which is cycled at 10Hz when termination is not activated. Note that if a FS_TERM_PIN is set then the heartbeat pin will continue to cycle at 10Hz when termination is activated, to allow the termination board to distinguish between autopilot crash and termination.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;HB_PIN&quot;</span>,      1, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _heartbeat_pin, -1),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// @Param: WP_COMMS</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// @DisplayName: Comms Waypoint</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// @Description: Waypoint number to navigate to on comms loss</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;WP_COMMS&quot;</span>,    2, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _wp_comms_hold, 0),</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// @Param: GPS_LOSS</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// @DisplayName: GPS Loss Waypoint</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// @Description: Waypoint number to navigate to on GPS lock loss</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;WP_GPS_LOSS&quot;</span>, 4, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _wp_gps_loss, 0),</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// @Param: TERMINATE</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// @DisplayName: Force Terminate</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// @Description: Can be set in flight to force termination of the heartbeat signal</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TERMINATE&quot;</span>,   5, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _terminate, 0),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// @Param: TERM_ACTION</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// @DisplayName: Terminate action</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// @Description: This can be used to force an action on flight termination. Normally this is handled by an external failsafe board, but you can setup APM to handle it here. If set to 0 (which is the default) then no extra action is taken. If set to the magic value 42 then the plane will deliberately crash itself by setting maximum throws on all surfaces, and zero throttle</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TERM_ACTION&quot;</span>, 6, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _terminate_action, 0),</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// @Param: TERM_PIN</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// @DisplayName: Terminate Pin</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// @Description: This sets a digital output pin to set high on flight termination</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TERM_PIN&quot;</span>,    7, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _terminate_pin,    -1),</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// @Param: AMSL_LIMIT</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @DisplayName: AMSL limit</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// @Description: This sets the AMSL (above mean sea level) altitude limit. If the pressure altitude determined by QNH exceeds this limit then flight termination will be forced. Note that this limit is in meters, whereas pressure altitude limits are often quoted in feet. A value of zero disables the pressure altitude limit.</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// @Units: meters</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;AMSL_LIMIT&quot;</span>,   8, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _amsl_limit,    0),</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// @Param: AMSL_ERR_GPS</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @DisplayName: Error margin for GPS based AMSL limit</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @Description: This sets margin for error in GPS derived altitude limit. This error margin is only used if the barometer has failed. If the barometer fails then the GPS will be used to enforce the AMSL_LIMIT, but this margin will be subtracted from the AMSL_LIMIT first, to ensure that even with the given amount of GPS altitude error the pressure altitude is not breached. OBC users should set this to comply with their D2 safety case. A value of -1 will mean that barometer failure will lead to immediate termination.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// @Units: meters</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;AMSL_ERR_GPS&quot;</span>, 9, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _amsl_margin_gps,  -1),</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// @Param: QNH_PRESSURE</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// @DisplayName: QNH pressure</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// @Description: This sets the QNH pressure in millibars to be used for pressure altitude in the altitude limit. A value of zero disables the altitude limit.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// @Units: millibar</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;QNH_PRESSURE&quot;</span>, 10, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _qnh_pressure,    0),</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// *NOTE* index 11 is &quot;Enable&quot; and is moved to the top to allow AP_PARAM_FLAG_ENABLE</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// *NOTE* index 12 of AP_Int16 RC_FAIL_MS was depreciated. Replaced by RC_FAIL_TIME.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// @Param: MAX_GPS_LOSS</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// @DisplayName: Maximum number of GPS loss events</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// @Description: Maximum number of GPS loss events before the aircraft stops returning to mission on GPS recovery. Use zero to allow for any number of GPS loss events.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAX_GPS_LOSS&quot;</span>, 13, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _max_gps_loss, 0),</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// @Param: MAX_COM_LOSS</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// @DisplayName: Maximum number of comms loss events</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// @Description: Maximum number of comms loss events before the aircraft stops returning to mission on comms recovery. Use zero to allow for any number of comms loss events.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MAX_COM_LOSS&quot;</span>, 14, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _max_comms_loss, 0),</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// @Param: GEOFENCE</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// @DisplayName: Enable geofence Advanced Failsafe</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// @Description: This enables the geofence part of the AFS. Will only be in effect if AFS_ENABLE is also 1</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GEOFENCE&quot;</span>,     15, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _enable_geofence_fs, 1),</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// @Param: RC</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// @DisplayName: Enable RC Advanced Failsafe</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// @Description: This enables the RC part of the AFS. Will only be in effect if AFS_ENABLE is also 1</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RC&quot;</span>,           16, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _enable_RC_fs, 1),</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// @Param: RC_MAN_ONLY</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// @DisplayName: Enable RC Termination only in manual control modes</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// @Description: If this parameter is set to 1, then an RC loss will only cause the plane to terminate in manual control modes. If it is 0, then the plane will terminate in any flight mode.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RC_MAN_ONLY&quot;</span>,    17, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _rc_term_manual_only, 1),</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// @Param: DUAL_LOSS</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// @DisplayName: Enable dual loss terminate due to failure of both GCS and GPS simultaneously</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// @Description: This enables the dual loss termination part of the AFS system. If this parameter is 1 and both GPS and the ground control station fail simultaneously, this will be considered a &quot;dual loss&quot; and cause termination.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DUAL_LOSS&quot;</span>,      18, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _enable_dual_loss, 1),</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// @Param: RC_FAIL_TIME</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// @DisplayName: RC failure time</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// @Description: This is the time in seconds in manual mode that failsafe termination will activate if RC input is lost. For the OBC rules this should be (1.5). Use 0 to disable.</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// @Units: seconds</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RC_FAIL_TIME&quot;</span>,   19, <a class="code" href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a>, _rc_fail_time_seconds,    0),</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;};</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">// check for Failsafe conditions. This is called at 10Hz by the main</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">// ArduPlane code</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="classAP__AdvancedFailsafe.html#a017a878d56457eea9bd9a59c07b92190">  154</a></span>&#160;<a class="code" href="classAP__AdvancedFailsafe.html#a017a878d56457eea9bd9a59c07b92190">AP_AdvancedFailsafe::check</a>(uint32_t last_heartbeat_ms, <span class="keywordtype">bool</span> geofence_breached, uint32_t last_valid_rc_ms)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{    </div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a6865249ba020b1623c4c85e57f90266f">_enable</a>) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// we always check for fence breach</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classAP__AdvancedFailsafe.html#a3e319d2e59373d584cb83af87f044c90">_enable_geofence_fs</a>) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (geofence_breached || <a class="code" href="classAP__AdvancedFailsafe.html#afcae077373d7958b1dba0ebc6c25d61b">check_altlimit</a>()) {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Fence TERMINATE&quot;</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>.set_and_notify(1);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keyword">enum</span> <a class="code" href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274">control_mode</a> mode = <a class="code" href="classAP__AdvancedFailsafe.html#a95a65c3845d61a1a7a7bdde0c0f8254c">afs_mode</a>();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    </div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// check if RC termination is enabled</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// check for RC failure in manual mode or RC failure when AFS_RC_MANUAL is 0</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a> != <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00aae5c8e79d6441d32162c054f73a915ea">STATE_PREFLIGHT</a> &amp;&amp; !<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a> &amp;&amp; <a class="code" href="classAP__AdvancedFailsafe.html#af8d575501569431709108258cf591e56">_enable_RC_fs</a> &amp;&amp;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        (mode == <a class="code" href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274aad358d676bc197e3b1f0ddae66660920">AFS_MANUAL</a> || mode == <a class="code" href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274ac2d80de3b05a635a7afc7449cb564b7c">AFS_STABILIZED</a> || !<a class="code" href="classAP__AdvancedFailsafe.html#a22a2993720ddd125023a2aee3d392118">_rc_term_manual_only</a>) &amp;&amp;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="classAP__AdvancedFailsafe.html#aebc6cc141e0d70187d157915f68d11df">_rc_fail_time_seconds</a> &gt; 0 &amp;&amp;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            (<a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - last_valid_rc_ms) &gt; (<a class="code" href="classAP__AdvancedFailsafe.html#aebc6cc141e0d70187d157915f68d11df">_rc_fail_time_seconds</a> * 1000.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;RC failure terminate&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>.set_and_notify(1);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// tell the failsafe board if we are in manual control</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// mode. This tells it to pass through controls from the</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// receiver</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ad7fd5d27b489f5cc9517b94d489651a5">_manual_pin</a> != -1) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">pinMode</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ad7fd5d27b489f5cc9517b94d489651a5">_manual_pin</a>, <a class="code" href="GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">write</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ad7fd5d27b489f5cc9517b94d489651a5">_manual_pin</a>, mode==<a class="code" href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274aad358d676bc197e3b1f0ddae66660920">AFS_MANUAL</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">bool</span> gcs_link_ok = ((now - last_heartbeat_ms) &lt; 10000);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">bool</span> gps_lock_ok = ((now - <a class="code" href="classAP__AdvancedFailsafe.html#a93662937ff90c01bca40b4c6f58fc0d3">gps</a>.<a class="code" href="classAP__GPS.html#a2ce70cc34e62a3f0e5980f56d9a36856">last_fix_time_ms</a>()) &lt; 3000);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a>) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00aae5c8e79d6441d32162c054f73a915ea">STATE_PREFLIGHT</a>:</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// we startup in preflight mode. This mode ends when</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// we first enter auto.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">if</span> (mode == <a class="code" href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274a3a99d18d6acc91450eef1bd9fe40255c">AFS_AUTO</a>) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Starting AFS_AUTO&quot;</span>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a> = <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00afd4c96d95e9b98e4b64e14e598db32b4">STATE_AUTO</a>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00afd4c96d95e9b98e4b64e14e598db32b4">STATE_AUTO</a>:</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// this is the normal mode. </span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span> (!gcs_link_ok) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_ERROR, <span class="stringliteral">&quot;State DATA_LINK_LOSS&quot;</span>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a> = <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00a5e2fc87fa7d847c0aa78e8b087eccc31">STATE_DATA_LINK_LOSS</a>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#abf8e4e9fff62fe54d388496de5862d19">_wp_comms_hold</a>) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a> = <a class="code" href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">mission</a>.<a class="code" href="classAP__Mission.html#ae6d739c048b1f5abb99bd4839243ac7a">get_current_nav_cmd</a>().<a class="code" href="structAP__Mission_1_1Mission__Command.html#a5afe16b2b1a93a0cf340a4199a9c6c3a">index</a>;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">mission</a>.<a class="code" href="classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">set_current_cmd</a>(<a class="code" href="classAP__AdvancedFailsafe.html#abf8e4e9fff62fe54d388496de5862d19">_wp_comms_hold</a>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="comment">// if two events happen within 30s we consider it to be part of the same event</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">if</span> (now - <a class="code" href="classAP__AdvancedFailsafe.html#a84d97e23de0e1c2bd31c1ea76efebd20">_last_comms_loss_ms</a> &gt; 30*1000UL) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#a61429ac086203aefd0159f2ea94d0dbf">_comms_loss_count</a>++;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#a84d97e23de0e1c2bd31c1ea76efebd20">_last_comms_loss_ms</a> = now;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">if</span> (!gps_lock_ok) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_CRITICAL, <span class="stringliteral">&quot;State GPS_LOSS&quot;</span>);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a> = <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00a4662fd2ee687795769526067f9fa2d45">STATE_GPS_LOSS</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#a6d207b46588f5ad3c415dbab19bb4ea9">_wp_gps_loss</a>) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a> = <a class="code" href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">mission</a>.<a class="code" href="classAP__Mission.html#ae6d739c048b1f5abb99bd4839243ac7a">get_current_nav_cmd</a>().<a class="code" href="structAP__Mission_1_1Mission__Command.html#a5afe16b2b1a93a0cf340a4199a9c6c3a">index</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">mission</a>.<a class="code" href="classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">set_current_cmd</a>(<a class="code" href="classAP__AdvancedFailsafe.html#a6d207b46588f5ad3c415dbab19bb4ea9">_wp_gps_loss</a>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">// if two events happen within 30s we consider it to be part of the same event</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">if</span> (now - <a class="code" href="classAP__AdvancedFailsafe.html#a9c0237858b75edbaa30ceb68fdf75b7f">_last_gps_loss_ms</a> &gt; 30*1000UL) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#a9fd54ab277a329311a181734c0e5e95f">_gps_loss_count</a>++;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#a9c0237858b75edbaa30ceb68fdf75b7f">_last_gps_loss_ms</a> = now;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00a5e2fc87fa7d847c0aa78e8b087eccc31">STATE_DATA_LINK_LOSS</a>:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">if</span> (!gps_lock_ok) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="comment">// losing GPS lock when data link is lost</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="comment">// leads to termination if AFS_DUAL_LOSS is 1</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classAP__AdvancedFailsafe.html#adedd73417d71f961f39080ad6aaae9c4">_enable_dual_loss</a>) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Dual loss TERMINATE&quot;</span>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    <a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>.set_and_notify(1);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gcs_link_ok) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a> = <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00afd4c96d95e9b98e4b64e14e598db32b4">STATE_AUTO</a>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;GCS OK&quot;</span>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment">// we only return to the mission if we have not exceeded AFS_MAX_COM_LOSS</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a> != 0 &amp;&amp; </div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                (<a class="code" href="classAP__AdvancedFailsafe.html#a8237bcc5d05e387f036e5cf02d90b7d4">_max_comms_loss</a> &lt;= 0 || </div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                 <a class="code" href="classAP__AdvancedFailsafe.html#a61429ac086203aefd0159f2ea94d0dbf">_comms_loss_count</a> &lt;= <a class="code" href="classAP__AdvancedFailsafe.html#a8237bcc5d05e387f036e5cf02d90b7d4">_max_comms_loss</a>)) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">mission</a>.<a class="code" href="classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">set_current_cmd</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a>);            </div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a> = 0;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00a4662fd2ee687795769526067f9fa2d45">STATE_GPS_LOSS</a>:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">if</span> (!gcs_link_ok) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="comment">// losing GCS link when GPS lock lost</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="comment">// leads to termination if AFS_DUAL_LOSS is 1</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a> &amp;&amp; <a class="code" href="classAP__AdvancedFailsafe.html#adedd73417d71f961f39080ad6aaae9c4">_enable_dual_loss</a>) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_CRITICAL, <span class="stringliteral">&quot;Dual loss TERMINATE&quot;</span>);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>.set_and_notify(1);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gps_lock_ok) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;GPS OK&quot;</span>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">_state</a> = <a class="code" href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00afd4c96d95e9b98e4b64e14e598db32b4">STATE_AUTO</a>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="comment">// we only return to the mission if we have not exceeded AFS_MAX_GPS_LOSS</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a> != 0 &amp;&amp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                (<a class="code" href="classAP__AdvancedFailsafe.html#a401bb6e7f4a88094a5b6abc87f7f3061">_max_gps_loss</a> &lt;= 0 || <a class="code" href="classAP__AdvancedFailsafe.html#a9fd54ab277a329311a181734c0e5e95f">_gps_loss_count</a> &lt;= <a class="code" href="classAP__AdvancedFailsafe.html#a401bb6e7f4a88094a5b6abc87f7f3061">_max_gps_loss</a>)) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">mission</a>.<a class="code" href="classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">set_current_cmd</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a>);            </div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <a class="code" href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">_saved_wp</a> = 0;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// if we are not terminating or if there is a separate terminate</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// pin configured then toggle the heartbeat pin at 10Hz</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">_heartbeat_pin</a> != -1 &amp;&amp; (<a class="code" href="classAP__AdvancedFailsafe.html#a7881bad66fa1915a99987ddf149397bf">_terminate_pin</a> != -1 || !<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>)) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">_heartbeat_pin_value</a> = !<a class="code" href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">_heartbeat_pin_value</a>;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">pinMode</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">_heartbeat_pin</a>, <a class="code" href="GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">write</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">_heartbeat_pin</a>, <a class="code" href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">_heartbeat_pin_value</a>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }    </div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// set the terminate pin</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#a7881bad66fa1915a99987ddf149397bf">_terminate_pin</a> != -1) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">pinMode</a>(<a class="code" href="classAP__AdvancedFailsafe.html#a7881bad66fa1915a99987ddf149397bf">_terminate_pin</a>, <a class="code" href="GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">write</a>(<a class="code" href="classAP__AdvancedFailsafe.html#a7881bad66fa1915a99987ddf149397bf">_terminate_pin</a>, <a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>?1:0);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }    </div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;}</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">// send heartbeat messages during sensor calibration</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="classAP__AdvancedFailsafe.html#a8ab12bb0cf2dbe521977f3b9fac57dd1">  297</a></span>&#160;<a class="code" href="classAP__AdvancedFailsafe.html#a8ab12bb0cf2dbe521977f3b9fac57dd1">AP_AdvancedFailsafe::heartbeat</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{    </div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a6865249ba020b1623c4c85e57f90266f">_enable</a>) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// if we are not terminating or if there is a separate terminate</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// pin configured then toggle the heartbeat pin at 10Hz</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">_heartbeat_pin</a> != -1 &amp;&amp; (<a class="code" href="classAP__AdvancedFailsafe.html#a7881bad66fa1915a99987ddf149397bf">_terminate_pin</a> != -1 || !<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a>)) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <a class="code" href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">_heartbeat_pin_value</a> = !<a class="code" href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">_heartbeat_pin_value</a>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">pinMode</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">_heartbeat_pin</a>, <a class="code" href="GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code" href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">write</a>(<a class="code" href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">_heartbeat_pin</a>, <a class="code" href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">_heartbeat_pin_value</a>);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }    </div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">// check for altitude limit breach</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="classAP__AdvancedFailsafe.html#afcae077373d7958b1dba0ebc6c25d61b">  314</a></span>&#160;<a class="code" href="classAP__AdvancedFailsafe.html#afcae077373d7958b1dba0ebc6c25d61b">AP_AdvancedFailsafe::check_altlimit</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{    </div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a6865249ba020b1623c4c85e57f90266f">_enable</a>) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#aaae260b7649276113b67cc3719999647">_amsl_limit</a> == 0 || <a class="code" href="classAP__AdvancedFailsafe.html#a14e2f05976685e710d3d45f1c95400a2">_qnh_pressure</a> &lt;= 0) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="comment">// no limit set</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// see if the barometer is dead</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code" href="classAP__AdvancedFailsafe.html#a811159131a231fa5475ca24f0dc1c4d2">baro</a>.<a class="code" href="classAP__Baro.html#aae5b3ae28aca807eb20b722a04685061">get_last_update</a>() &gt; 5000) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">// the barometer has been unresponsive for 5 seconds. See if we can switch to GPS</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__AdvancedFailsafe.html#a3a22631a7285538228962320e3aa6437">_amsl_margin_gps</a> != -1 &amp;&amp;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#a93662937ff90c01bca40b4c6f58fc0d3">gps</a>.<a class="code" href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">status</a>() &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a> &amp;&amp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <a class="code" href="classAP__AdvancedFailsafe.html#a93662937ff90c01bca40b4c6f58fc0d3">gps</a>.<a class="code" href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">location</a>().<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>*0.01f &lt;= <a class="code" href="classAP__AdvancedFailsafe.html#aaae260b7649276113b67cc3719999647">_amsl_limit</a> - <a class="code" href="classAP__AdvancedFailsafe.html#a3a22631a7285538228962320e3aa6437">_amsl_margin_gps</a>) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="comment">// GPS based altitude OK</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">// no barometer - immediate termination</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">float</span> alt_amsl = <a class="code" href="classAP__AdvancedFailsafe.html#a811159131a231fa5475ca24f0dc1c4d2">baro</a>.<a class="code" href="classAP__Baro.html#ac46bc3a53717630410a48a1c1a5f2444">get_altitude_difference</a>(<a class="code" href="classAP__AdvancedFailsafe.html#a14e2f05976685e710d3d45f1c95400a2">_qnh_pressure</a>*100, <a class="code" href="classAP__AdvancedFailsafe.html#a811159131a231fa5475ca24f0dc1c4d2">baro</a>.<a class="code" href="classAP__Baro.html#aafa0e900262503f0ba84d4cadcf888d7">get_pressure</a>());</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (alt_amsl &gt; <a class="code" href="classAP__AdvancedFailsafe.html#aaae260b7649276113b67cc3719999647">_amsl_limit</a>) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="comment">// pressure altitude breach</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// all OK</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">  return true if we should crash the vehicle</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="classAP__AdvancedFailsafe.html#a900ff082f11cf536095896eab27ad54c">  350</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__AdvancedFailsafe.html#a900ff082f11cf536095896eab27ad54c">AP_AdvancedFailsafe::should_crash_vehicle</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;{</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a6865249ba020b1623c4c85e57f90266f">_enable</a>) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// ensure failsafe values are setup for if FMU crashes on PX4/Pixhawk</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#ad939d3f2edcca6e08332b0ad17adcf2b">_failsafe_setup</a>) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <a class="code" href="classAP__AdvancedFailsafe.html#ad939d3f2edcca6e08332b0ad17adcf2b">_failsafe_setup</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="classAP__AdvancedFailsafe.html#ac6c3bcc8c04239066e7b3250bc0e5764">setup_IO_failsafe</a>();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// should we crash the plane? Only possible with</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">// FS_TERM_ACTTION set to 42</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">_terminate</a> || <a class="code" href="classAP__AdvancedFailsafe.html#a51554f9d6766c5c0258568ba4debd34e">_terminate_action</a> != 42) {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// not terminating</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">// we are crashing</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div><div class="ttc" id="classAP__AdvancedFailsafe_html_adedd73417d71f961f39080ad6aaae9c4"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#adedd73417d71f961f39080ad6aaae9c4">AP_AdvancedFailsafe::_enable_dual_loss</a></div><div class="ttdeci">AP_Int8 _enable_dual_loss</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00116">AP_AdvancedFailsafe.h:116</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ad939d3f2edcca6e08332b0ad17adcf2b"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ad939d3f2edcca6e08332b0ad17adcf2b">AP_AdvancedFailsafe::_failsafe_setup</a></div><div class="ttdeci">bool _failsafe_setup</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00136">AP_AdvancedFailsafe.h:136</a></div></div>
<div class="ttc" id="classAP__GPS_html_a2ce70cc34e62a3f0e5980f56d9a36856"><div class="ttname"><a href="classAP__GPS.html#a2ce70cc34e62a3f0e5980f56d9a36856">AP_GPS::last_fix_time_ms</a></div><div class="ttdeci">uint32_t last_fix_time_ms(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00283">AP_GPS.h:283</a></div></div>
<div class="ttc" id="AP__Param_8h_html_ae25c1c7495435989f8be5781c86be078"><div class="ttname"><a href="AP__Param_8h.html#ae25c1c7495435989f8be5781c86be078">AP_PARAM_FLAG_ENABLE</a></div><div class="ttdeci">#define AP_PARAM_FLAG_ENABLE</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00046">AP_Param.h:46</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ae4f3a323abccc6bc762ff16d127b6fcf"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ae4f3a323abccc6bc762ff16d127b6fcf">AP_AdvancedFailsafe::_heartbeat_pin</a></div><div class="ttdeci">AP_Int8 _heartbeat_pin</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00097">AP_AdvancedFailsafe.h:97</a></div></div>
<div class="ttc" id="classGCS__MAVLINK_html_ae1d5ebd46ec3ddb644862c747e2968bf"><div class="ttname"><a href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a></div><div class="ttdeci">static void send_statustext_all(MAV_SEVERITY severity, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Common_8cpp_source.html#l01322">GCS_Common.cpp:1322</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html"><div class="ttname"><a href="classAP__AdvancedFailsafe.html">AP_AdvancedFailsafe</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00032">AP_AdvancedFailsafe.h:32</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a8ab12bb0cf2dbe521977f3b9fac57dd1"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a8ab12bb0cf2dbe521977f3b9fac57dd1">AP_AdvancedFailsafe::heartbeat</a></div><div class="ttdeci">void heartbeat(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8cpp_source.html#l00297">AP_AdvancedFailsafe.cpp:297</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ab0d7176e84f494339cecffc2a7769274"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274">AP_AdvancedFailsafe::control_mode</a></div><div class="ttdeci">control_mode</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00035">AP_AdvancedFailsafe.h:35</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a95a65c3845d61a1a7a7bdde0c0f8254c"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a95a65c3845d61a1a7a7bdde0c0f8254c">AP_AdvancedFailsafe::afs_mode</a></div><div class="ttdeci">virtual enum control_mode afs_mode(void)=0</div></div>
<div class="ttc" id="GCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System. </div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00087">AP_Param.h:87</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ab0d7176e84f494339cecffc2a7769274aad358d676bc197e3b1f0ddae66660920"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274aad358d676bc197e3b1f0ddae66660920">AP_AdvancedFailsafe::AFS_MANUAL</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00036">AP_AdvancedFailsafe.h:36</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_aaae260b7649276113b67cc3719999647"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#aaae260b7649276113b67cc3719999647">AP_AdvancedFailsafe::_amsl_limit</a></div><div class="ttdeci">AP_Int32 _amsl_limit</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00108">AP_AdvancedFailsafe.h:108</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ace77de09d0e1ac0293aa8d634be0839a"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ace77de09d0e1ac0293aa8d634be0839a">AP_AdvancedFailsafe::_state</a></div><div class="ttdeci">enum state _state</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00088">AP_AdvancedFailsafe.h:88</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a91f5a9ca855699997a6ce1afb4355e00a5e2fc87fa7d847c0aa78e8b087eccc31"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00a5e2fc87fa7d847c0aa78e8b087eccc31">AP_AdvancedFailsafe::STATE_DATA_LINK_LOSS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00044">AP_AdvancedFailsafe.h:44</a></div></div>
<div class="ttc" id="classAP__Baro_html_ac46bc3a53717630410a48a1c1a5f2444"><div class="ttname"><a href="classAP__Baro.html#ac46bc3a53717630410a48a1c1a5f2444">AP_Baro::get_altitude_difference</a></div><div class="ttdeci">float get_altitude_difference(float base_pressure, float pressure) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8cpp_source.html#l00251">AP_Baro.cpp:251</a></div></div>
<div class="ttc" id="classAP__Mission_html_ae6d739c048b1f5abb99bd4839243ac7a"><div class="ttname"><a href="classAP__Mission.html#ae6d739c048b1f5abb99bd4839243ac7a">AP_Mission::get_current_nav_cmd</a></div><div class="ttdeci">const Mission_Command &amp; get_current_nav_cmd() const </div><div class="ttdoc">get_current_nav_cmd - returns the current &quot;navigation&quot; command </div><div class="ttdef"><b>Definition:</b> <a href="AP__Mission_8h_source.html#l00352">AP_Mission.h:352</a></div></div>
<div class="ttc" id="classAP__HAL_1_1GPIO_html_a2b0664bdab1876e3b0bbcd9064eec88e"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">AP_HAL::GPIO::write</a></div><div class="ttdeci">virtual void write(uint8_t pin, uint8_t value)=0</div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a61429ac086203aefd0159f2ea94d0dbf"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a61429ac086203aefd0159f2ea94d0dbf">AP_AdvancedFailsafe::_comms_loss_count</a></div><div class="ttdeci">uint8_t _comms_loss_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00127">AP_AdvancedFailsafe.h:127</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a93662937ff90c01bca40b4c6f58fc0d3"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a93662937ff90c01bca40b4c6f58fc0d3">AP_AdvancedFailsafe::gps</a></div><div class="ttdeci">const AP_GPS &amp; gps</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00092">AP_AdvancedFailsafe.h:92</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a51554f9d6766c5c0258568ba4debd34e"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a51554f9d6766c5c0258568ba4debd34e">AP_AdvancedFailsafe::_terminate_action</a></div><div class="ttdeci">AP_Int8 _terminate_action</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00101">AP_AdvancedFailsafe.h:101</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a6d207b46588f5ad3c415dbab19bb4ea9"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a6d207b46588f5ad3c415dbab19bb4ea9">AP_AdvancedFailsafe::_wp_gps_loss</a></div><div class="ttdeci">AP_Int8 _wp_gps_loss</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00105">AP_AdvancedFailsafe.h:105</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_af8d575501569431709108258cf591e56"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#af8d575501569431709108258cf591e56">AP_AdvancedFailsafe::_enable_RC_fs</a></div><div class="ttdeci">AP_Int8 _enable_RC_fs</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00114">AP_AdvancedFailsafe.h:114</a></div></div>
<div class="ttc" id="AP__Param_8h_html_ac24e2eb16c2194e975d27e47ddcb7f1c"><div class="ttname"><a href="AP__Param_8h.html#ac24e2eb16c2194e975d27e47ddcb7f1c">AP_GROUPINFO_FLAGS</a></div><div class="ttdeci">#define AP_GROUPINFO_FLAGS(name, idx, clazz, element, def, flags)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00078">AP_Param.h:78</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a84d97e23de0e1c2bd31c1ea76efebd20"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a84d97e23de0e1c2bd31c1ea76efebd20">AP_AdvancedFailsafe::_last_comms_loss_ms</a></div><div class="ttdeci">uint32_t _last_comms_loss_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00130">AP_AdvancedFailsafe.h:130</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a6865249ba020b1623c4c85e57f90266f"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a6865249ba020b1623c4c85e57f90266f">AP_AdvancedFailsafe::_enable</a></div><div class="ttdeci">AP_Int8 _enable</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00095">AP_AdvancedFailsafe.h:95</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ac6c3bcc8c04239066e7b3250bc0e5764"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ac6c3bcc8c04239066e7b3250bc0e5764">AP_AdvancedFailsafe::setup_IO_failsafe</a></div><div class="ttdeci">virtual void setup_IO_failsafe(void)=0</div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_af8f3497ee744785c7cbfabcd6e057fc0"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#af8f3497ee744785c7cbfabcd6e057fc0">AP_AdvancedFailsafe::mission</a></div><div class="ttdeci">AP_Mission &amp; mission</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00090">AP_AdvancedFailsafe.h:90</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a8237bcc5d05e387f036e5cf02d90b7d4"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a8237bcc5d05e387f036e5cf02d90b7d4">AP_AdvancedFailsafe::_max_comms_loss</a></div><div class="ttdeci">AP_Int8 _max_comms_loss</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00112">AP_AdvancedFailsafe.h:112</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00018">HAL.h:18</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a811159131a231fa5475ca24f0dc1c4d2"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a811159131a231fa5475ca24f0dc1c4d2">AP_AdvancedFailsafe::baro</a></div><div class="ttdeci">AP_Baro &amp; baro</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00091">AP_AdvancedFailsafe.h:91</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a91f5a9ca855699997a6ce1afb4355e00afd4c96d95e9b98e4b64e14e598db32b4"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00afd4c96d95e9b98e4b64e14e598db32b4">AP_AdvancedFailsafe::STATE_AUTO</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00043">AP_AdvancedFailsafe.h:43</a></div></div>
<div class="ttc" id="structLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdoc">param 2 - Altitude in centimeters (meters * 100) see LOCATION_ALT_MAX_M </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00128">AP_Common.h:128</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a3a22631a7285538228962320e3aa6437"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a3a22631a7285538228962320e3aa6437">AP_AdvancedFailsafe::_amsl_margin_gps</a></div><div class="ttdeci">AP_Int32 _amsl_margin_gps</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00109">AP_AdvancedFailsafe.h:109</a></div></div>
<div class="ttc" id="RC__Channel_8h_html"><div class="ttname"><a href="RC__Channel_8h.html">RC_Channel.h</a></div><div class="ttdoc">RC_Channel manager, with EEPROM-backed storage of constants. </div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classAP__GPS_html_a2ca8a9bad47faad1baeb09e124979022"><div class="ttname"><a href="classAP__GPS.html#a2ca8a9bad47faad1baeb09e124979022">AP_GPS::location</a></div><div class="ttdeci">const Location &amp; location(uint8_t instance) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00182">AP_GPS.h:182</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_aebc6cc141e0d70187d157915f68d11df"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#aebc6cc141e0d70187d157915f68d11df">AP_AdvancedFailsafe::_rc_fail_time_seconds</a></div><div class="ttdeci">AP_Float _rc_fail_time_seconds</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00110">AP_AdvancedFailsafe.h:110</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="AP__HAL__Linux_2system_8cpp_source.html#l00043">system.cpp:43</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a9fd54ab277a329311a181734c0e5e95f"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a9fd54ab277a329311a181734c0e5e95f">AP_AdvancedFailsafe::_gps_loss_count</a></div><div class="ttdeci">uint8_t _gps_loss_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00124">AP_AdvancedFailsafe.h:124</a></div></div>
<div class="ttc" id="structAP__Mission_1_1Mission__Command_html_a5afe16b2b1a93a0cf340a4199a9c6c3a"><div class="ttname"><a href="structAP__Mission_1_1Mission__Command.html#a5afe16b2b1a93a0cf340a4199a9c6c3a">AP_Mission::Mission_Command::index</a></div><div class="ttdeci">uint16_t index</div><div class="ttdef"><b>Definition:</b> <a href="AP__Mission_8h_source.html#l00245">AP_Mission.h:245</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00126">AP_Param.h:126</a></div></div>
<div class="ttc" id="classAP__HAL_1_1GPIO_html_a3dfc60214bd1aa4936d51ca72c045b95"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">AP_HAL::GPIO::pinMode</a></div><div class="ttdeci">virtual void pinMode(uint8_t pin, uint8_t output)=0</div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a91f5a9ca855699997a6ce1afb4355e00aae5c8e79d6441d32162c054f73a915ea"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00aae5c8e79d6441d32162c054f73a915ea">AP_AdvancedFailsafe::STATE_PREFLIGHT</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00042">AP_AdvancedFailsafe.h:42</a></div></div>
<div class="ttc" id="classAP__Baro_html_aafa0e900262503f0ba84d4cadcf888d7"><div class="ttname"><a href="classAP__Baro.html#aafa0e900262503f0ba84d4cadcf888d7">AP_Baro::get_pressure</a></div><div class="ttdeci">float get_pressure(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00046">AP_Baro.h:46</a></div></div>
<div class="ttc" id="AP__AdvancedFailsafe_8h_html"><div class="ttname"><a href="AP__AdvancedFailsafe_8h.html">AP_AdvancedFailsafe.h</a></div></div>
<div class="ttc" id="classAP__Mission_html_ac79a188f81816b3ddfe045b6a0feb6d1"><div class="ttname"><a href="classAP__Mission.html#ac79a188f81816b3ddfe045b6a0feb6d1">AP_Mission::set_current_cmd</a></div><div class="ttdeci">bool set_current_cmd(uint16_t index)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Mission_8cpp_source.html#l00315">AP_Mission.cpp:315</a></div></div>
<div class="ttc" id="classAP__GPS_html_a9093c8cf1d5a78ccd8677229bb314d37"><div class="ttname"><a href="classAP__GPS.html#a9093c8cf1d5a78ccd8677229bb314d37">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(uint8_t instance) const </div><div class="ttdoc">Query GPS status. </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00171">AP_GPS.h:171</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a401bb6e7f4a88094a5b6abc87f7f3061"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a401bb6e7f4a88094a5b6abc87f7f3061">AP_AdvancedFailsafe::_max_gps_loss</a></div><div class="ttdeci">AP_Int8 _max_gps_loss</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00111">AP_AdvancedFailsafe.h:111</a></div></div>
<div class="ttc" id="GPIO_8h_html_a12ba3ca9b5828d7f2978da045de8d11f"><div class="ttname"><a href="GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a></div><div class="ttdeci">#define HAL_GPIO_OUTPUT</div><div class="ttdef"><b>Definition:</b> <a href="GPIO_8h_source.html#l00008">GPIO.h:8</a></div></div>
<div class="ttc" id="classAP__Baro_html_aae5b3ae28aca807eb20b722a04685061"><div class="ttname"><a href="classAP__Baro.html#aae5b3ae28aca807eb20b722a04685061">AP_Baro::get_last_update</a></div><div class="ttdeci">uint32_t get_last_update(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00099">AP_Baro.h:99</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ad921c8dd44bab8138f02ee81ee3e4b42"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ad921c8dd44bab8138f02ee81ee3e4b42">AP_AdvancedFailsafe::_saved_wp</a></div><div class="ttdeci">uint8_t _saved_wp</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00121">AP_AdvancedFailsafe.h:121</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a36631ff91e8e08cf71549bd3e3f32277"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a36631ff91e8e08cf71549bd3e3f32277">AP_AdvancedFailsafe::_terminate</a></div><div class="ttdeci">AP_Int8 _terminate</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00100">AP_AdvancedFailsafe.h:100</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a6826fdda1754d300e115690327835fae"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a6826fdda1754d300e115690327835fae">AP_AdvancedFailsafe::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00076">AP_AdvancedFailsafe.h:76</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a9c0237858b75edbaa30ceb68fdf75b7f"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a9c0237858b75edbaa30ceb68fdf75b7f">AP_AdvancedFailsafe::_last_gps_loss_ms</a></div><div class="ttdeci">uint32_t _last_gps_loss_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00133">AP_AdvancedFailsafe.h:133</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ad7fd5d27b489f5cc9517b94d489651a5"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ad7fd5d27b489f5cc9517b94d489651a5">AP_AdvancedFailsafe::_manual_pin</a></div><div class="ttdeci">AP_Int8 _manual_pin</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00098">AP_AdvancedFailsafe.h:98</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ab0d7176e84f494339cecffc2a7769274ac2d80de3b05a635a7afc7449cb564b7c"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274ac2d80de3b05a635a7afc7449cb564b7c">AP_AdvancedFailsafe::AFS_STABILIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00037">AP_AdvancedFailsafe.h:37</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a14e2f05976685e710d3d45f1c95400a2"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a14e2f05976685e710d3d45f1c95400a2">AP_AdvancedFailsafe::_qnh_pressure</a></div><div class="ttdeci">AP_Float _qnh_pressure</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00107">AP_AdvancedFailsafe.h:107</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ab0d7176e84f494339cecffc2a7769274a3a99d18d6acc91450eef1bd9fe40255c"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ab0d7176e84f494339cecffc2a7769274a3a99d18d6acc91450eef1bd9fe40255c">AP_AdvancedFailsafe::AFS_AUTO</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00038">AP_AdvancedFailsafe.h:38</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a017a878d56457eea9bd9a59c07b92190"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a017a878d56457eea9bd9a59c07b92190">AP_AdvancedFailsafe::check</a></div><div class="ttdeci">void check(uint32_t last_heartbeat_ms, bool geofence_breached, uint32_t last_valid_rc_ms)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8cpp_source.html#l00154">AP_AdvancedFailsafe.cpp:154</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a13ed800ad745085097f4d6dce9070eb0"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">AP_HAL::HAL::gpio</a></div><div class="ttdeci">AP_HAL::GPIO * gpio</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00090">HAL.h:90</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_afcae077373d7958b1dba0ebc6c25d61b"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#afcae077373d7958b1dba0ebc6c25d61b">AP_AdvancedFailsafe::check_altlimit</a></div><div class="ttdeci">bool check_altlimit(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8cpp_source.html#l00314">AP_AdvancedFailsafe.cpp:314</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a22a2993720ddd125023a2aee3d392118"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a22a2993720ddd125023a2aee3d392118">AP_AdvancedFailsafe::_rc_term_manual_only</a></div><div class="ttdeci">AP_Int8 _rc_term_manual_only</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00115">AP_AdvancedFailsafe.h:115</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a91f5a9ca855699997a6ce1afb4355e00a4662fd2ee687795769526067f9fa2d45"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a91f5a9ca855699997a6ce1afb4355e00a4662fd2ee687795769526067f9fa2d45">AP_AdvancedFailsafe::STATE_GPS_LOSS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00045">AP_AdvancedFailsafe.h:45</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_abf8e4e9fff62fe54d388496de5862d19"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#abf8e4e9fff62fe54d388496de5862d19">AP_AdvancedFailsafe::_wp_comms_hold</a></div><div class="ttdeci">AP_Int8 _wp_comms_hold</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00104">AP_AdvancedFailsafe.h:104</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a></div><div class="ttdoc">Receiving valid messages and 3D lock. </div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00094">AP_GPS.h:94</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a3e319d2e59373d584cb83af87f044c90"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a3e319d2e59373d584cb83af87f044c90">AP_AdvancedFailsafe::_enable_geofence_fs</a></div><div class="ttdeci">AP_Int8 _enable_geofence_fs</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00113">AP_AdvancedFailsafe.h:113</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a900ff082f11cf536095896eab27ad54c"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a900ff082f11cf536095896eab27ad54c">AP_AdvancedFailsafe::should_crash_vehicle</a></div><div class="ttdeci">bool should_crash_vehicle(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8cpp_source.html#l00350">AP_AdvancedFailsafe.cpp:350</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_a7881bad66fa1915a99987ddf149397bf"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#a7881bad66fa1915a99987ddf149397bf">AP_AdvancedFailsafe::_terminate_pin</a></div><div class="ttdeci">AP_Int8 _terminate_pin</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00099">AP_AdvancedFailsafe.h:99</a></div></div>
<div class="ttc" id="SRV__Channel_8h_html"><div class="ttname"><a href="SRV__Channel_8h.html">SRV_Channel.h</a></div></div>
<div class="ttc" id="classAP__AdvancedFailsafe_html_ada23c46e50551409aa48c7362ff31155"><div class="ttname"><a href="classAP__AdvancedFailsafe.html#ada23c46e50551409aa48c7362ff31155">AP_AdvancedFailsafe::_heartbeat_pin_value</a></div><div class="ttdeci">bool _heartbeat_pin_value</div><div class="ttdef"><b>Definition:</b> <a href="AP__AdvancedFailsafe_8h_source.html#l00118">AP_AdvancedFailsafe.h:118</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00102">AP_Param.h:102</a></div></div>
<div class="ttc" id="AP__AdvancedFailsafe_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__AdvancedFailsafe_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00010">AC_PID_test.cpp:10</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 14 2017 11:51:09 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
